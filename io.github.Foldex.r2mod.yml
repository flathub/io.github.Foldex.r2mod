app-id: io.github.Foldex.r2mod
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: r2mod

finish-args:
  # Needs Network to DL Mods
  - --share=network
  # Normal Steam
  - --filesystem=~/.local/share/Steam/steamapps/common/Risk of Rain 2
  - --filesystem=~/.local/share/Steam/steamapps/compatdata/632360
  # Flatpak Steam
  - --filesystem=~/.var/app/com.valvesoftware.Steam/.local/share/Steam/steamapps/common/Risk of Rain 2
  - --filesystem=~/.var/app/com.valvesoftware.Steam/.local/share/Steam/steamapps/compatdata/632360
  # tmp is where DLs go
  - --filesystem=/tmp/r2mod:create
  # Needed to install completions
  - --filesystem=~/.local/share/bash-completion/completions/:create
  - --filesystem=~/.local/share/zsh/site-functions/:create
  # Environment Vars
  - --env=R2MOD_INSTALL_DIR=default
  - --env=R2MOD_COMPAT_DIR=default

cleanup:
  - '*.a'
  - '*.la'
  - '/include'
  - '/lib/pkgconfig'
  - '/share/doc'
  - '/share/man'
  - '/bin/onig-config'

modules:
  # Main program
  - name: r2mod
    buildsystem: simple
    build-commands:
      - make flatpak
    sources:
      - type: archive
        dest-filename: r2mod.tar.gz
        url: https://github.com/Foldex/r2mod_cli/archive/refs/tags/v1.3.3.tar.gz
        sha256: ce3246afdb2789432f41c4547648233dfce7d5b2c6874ce1e849bb06f4a6fe38
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Foldex/r2mod_cli/releases/latest
          version-query: .tag_name
          url-query: .tarball_url

  # 7zip for extracting archives
  - name: p7zip
    buildsystem: simple
    build-commands:
      - make 7za
      - install -D -m 0755 bin/7za ${FLATPAK_DEST}/bin/7z
    sources:
      - type: archive
        dest-filename: p7zip.tar.gz
        url: https://github.com/p7zip-project/p7zip/archive/refs/tags/v17.04.tar.gz
        sha256: ea029a2e21d2d6ad0a156f6679bd66836204aa78148a4c5e498fe682e77127ef 
        x-checker-data:
          type: json
          url: https://api.github.com/repos/p7zip-project/p7zip/releases/latest
          version-query: .tag_name
          url-query: .tarball_url

  # Regex Lib Needed by jq
  - name: oniguruma
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/kkos/oniguruma/releases/download/v6.9.8/onig-6.9.8.tar.gz
        sha256: 28cd62c1464623c7910565fb1ccaaa0104b2fe8b12bcd646e81f73b47535213e
        x-checker-data:
          type: anitya
          project-id: 11184
          stable-only: true
          url-template: https://github.com/kkos/oniguruma/archive/refs/tags/v${version}.tar.gz

  # JSON parser
  - name: jq
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/stedolan/jq/releases/download/jq-1.6/jq-1.6.tar.gz
        sha256: 5de8c8e29aaa3fb9cc6b47bb27299f271354ebb72514e3accadc7d38b5bbaa72
        x-checker-data:
          type: anitya
          project-id: 13252
          stable-only: true
          url-template: https://github.com/stedolan/jq/archive/refs/tags/jq-${version}.tar.gz
