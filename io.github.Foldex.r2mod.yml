app-id: io.github.Foldex.r2mod
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: r2mod

finish-args:
  # Needs Network to DL Mods
  - --share=network
  # Normal Steam
  - --filesystem=~/.local/share/Steam/steamapps/common/Risk of Rain 2
  - --filesystem=~/.local/share/Steam/steamapps/compatdata/632360
  # Flatpak Steam
  - --filesystem=~/.var/app/com.valvesoftware.Steam/.local/share/Steam/steamapps/common/Risk
    of Rain 2
  - --filesystem=~/.var/app/com.valvesoftware.Steam/.local/share/Steam/steamapps/compatdata/632360
  # tmp is where DLs go
  - --filesystem=/tmp/r2mod:create
  # Needed to install completions
  - --filesystem=~/.local/share/bash-completion/completions/:create
  - --filesystem=~/.local/share/zsh/site-functions/:create
  # Environment Vars
  - --env=R2MOD_INSTALL_DIR=default
  - --env=R2MOD_COMPAT_DIR=default

cleanup:
  - '*.a'
  - '*.la'
  - /include
  - /lib/pkgconfig
  - /share/doc
  - /share/man
  - /bin/onig-config

modules:
  # Main program
  - name: r2mod
    buildsystem: simple
    build-commands:
      - make flatpak
    sources:
      - type: archive
        dest-filename: r2mod.tar.gz
        url: https://api.github.com/repos/Foldex/r2mod_cli/tarball/v1.3.3
        sha256: f6ee0656c33d5ff5c73eec1f861005ebf02a02ed7bf6a644fb27c1b221168c92
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Foldex/r2mod_cli/releases/latest
          version-query: .tag_name
          url-query: .tarball_url

  # 7zip for extracting archives
  - name: p7zip
    buildsystem: simple
    build-commands:
      - make 7za
      - install -D -m 0755 bin/7za ${FLATPAK_DEST}/bin/7z
    sources:
      - type: archive
        dest-filename: p7zip.tar.gz
        url: https://api.github.com/repos/p7zip-project/p7zip/tarball/v17.04
        sha256: f9957327ff24bd3d37f48c28b613dbf2a086b314dc7a6046816020ece7ff25aa
        x-checker-data:
          type: json
          url: https://api.github.com/repos/p7zip-project/p7zip/releases/latest
          version-query: .tag_name
          url-query: .tarball_url

  # Regex Lib Needed by jq
  - name: oniguruma
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/kkos/oniguruma/archive/refs/tags/v6.9.8.tar.gz
        sha256: ab11578e94993675bdd4fef77650a1e32fa56538233d486b84f9c14abde82148
        x-checker-data:
          type: anitya
          project-id: 11184
          stable-only: true
          url-template: https://github.com/kkos/oniguruma/archive/refs/tags/v${version}.tar.gz

  # JSON parser
  - name: jq
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/stedolan/jq/archive/refs/tags/jq-1.6.tar.gz
        sha256: c963dce42cf28d1f848013485ac708627e665a4028013bb90209add43add9763
        x-checker-data:
          type: anitya
          project-id: 13252
          stable-only: true
          url-template: https://github.com/stedolan/jq/archive/refs/tags/jq-${version}.tar.gz
